# =============================================================================
# AI Backoffice MVP — project tooling configuration
# =============================================================================

# ── ruff ──────────────────────────────────────────────────────────────────────

[tool.ruff]
# Match the line length used throughout the codebase.
line-length = 120
target-version = "py312"

# Directories / files to skip entirely.
exclude = [
    ".git",
    ".venv",
    "__pycache__",
    "data/",
]

[tool.ruff.lint]
# E/W  — pycodestyle errors & warnings
# F    — pyflakes (unused imports, undefined names, …)
# I    — isort (import ordering)
# UP   — pyupgrade (modern Python syntax)  — but see ignore list below
select = ["E", "W", "F", "I", "UP"]

ignore = [
    # UP007: "Use `X | Y` instead of `Optional[X]`" — too noisy for an existing
    #        codebase; the Optional[] style is still perfectly valid Python.
    "UP007",
    # E501: line too long — ruff format already handles line length; we don't
    #       want duplicate warnings for the rare long string literal.
    "E501",
]

[tool.ruff.lint.per-file-ignores]
# Alembic env.py must do a late sys.path insert before importing app models.
"alembic/env.py" = ["E402", "F401"]
# __init__.py re-exports for Alembic's metadata.create_all() discovery.
"app/models/__init__.py" = ["F401"]
# Test helpers use broad `except Exception` and bare fixtures intentionally.
"tests/*" = ["F841"]

[tool.ruff.lint.isort]
# Keep first-party imports (app.*) clearly separated from third-party ones.
known-first-party = ["app"]

[tool.ruff.format]
# Use double quotes everywhere — consistent with the rest of the codebase.
quote-style = "double"
indent-style = "space"
line-ending = "lf"

# ── mypy ─────────────────────────────────────────────────────────────────────

[tool.mypy]
python_version = "3.12"
ignore_missing_imports = true
strict = false
# SQLAlchemy 2.0 mapped_column() patterns generate many false positives with
# strict assignments; disable the noisiest ones without going fully strict.
disable_error_code = ["assignment", "arg-type"]
# Skip Alembic migration scripts — they are auto-generated and not worth typing.
exclude = ["alembic/"]

# ── pytest ────────────────────────────────────────────────────────────────────

[tool.pytest.ini_options]
testpaths = ["tests"]
asyncio_mode = "auto"
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
log_cli = true
log_cli_level = "WARNING"
